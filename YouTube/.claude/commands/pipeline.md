# /pipeline コマンド

リサーチから台本完成まで、自動改善サイクルを実行するパイプライン

## 使用方法

```
/pipeline [テーマ]                    # 基本実行
/pipeline [テーマ] --skip-research    # リサーチスキップ
/pipeline [テーマ] --target-score 95  # 目標スコア指定
```

## 実行手順

このコマンドは以下のエージェントを順次起動し、品質基準を満たすまで自動で改善サイクルを回します。

---

### Step 1: リサーチフェーズ

**実行するエージェント**:
1. `research-agent` - 競合動画分析
2. `trend-researcher-agent` - 外部トレンド収集（並行実行）

**確認事項**:
- `research/data/videos.csv` の最終更新日
- 7日以内なら `--skip-research` オプションを提案

**出力**:
```
research/analysis/YYYYMMDD_[テーマ].md
research/trends/YYYYMMDD_[テーマ].md
research/reference_titles.md
```

---

### Step 2: 台本生成フェーズ

**実行するエージェント**:
- `video-concept-agent`

**入力**:
- テーマ
- 参考タイトル（Step 1の出力）
- トレンド情報（Step 1の出力）

**出力**:
```
scripts/drafts/YYYYMMDD_[テーマ]_v1.md
```

---

### Step 3: レビューフェーズ

**実行するエージェント**:
- `script-reviewer-agent`

**評価軸**:
| 軸 | 満点 |
|----|------|
| フック力 | 25 |
| 構成力 | 25 |
| 具体性 | 20 |
| 差別化 | 15 |
| CTA | 15 |

**判定ロジック**:
```
if スコア >= 90:
    → Step 5（採用）
elif スコア >= 70:
    → Step 4（改善）、軽微修正後採用可
else:
    → Step 4（改善）、必須
```

---

### Step 4: 改善フェーズ（必要時のみ）

**実行するエージェント**:
- `script-improver-agent`

**入力**:
- 現行台本
- レビューレポート（改善ポイント含む）

**出力**:
```
scripts/drafts/YYYYMMDD_[テーマ]_v{n+1}.md
```

**その後**: Step 3 に戻り再レビュー

**制限**: 最大3回まで改善を繰り返す

---

### Step 5: 採用・保存フェーズ

**実行内容**:
1. 最終台本を `scripts/final/` に保存
2. 全バージョン履歴を保持
3. パイプライン実行サマリーを出力

**出力**:
```
scripts/final/YYYYMMDD_[テーマ].md
```

---

## 出力例

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 Pipeline: AIエージェント自動化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[Phase 1] Research
├─ ✅ 優秀動画: 85件発見
├─ ✅ トレンド: 5トピック収集
└─ 参考タイトル: 10件選定

[Phase 2] Concept
├─ ✅ 台本v1生成完了
└─ タイトル: 「Cursorを学ぶな。"問いの立て方"を学べ」

[Phase 3] Review #1 → 72/100
├─ フック力: 18/25
├─ 構成力: 20/25
├─ 具体性: 12/20
├─ 差別化: 12/15
└─ CTA: 10/15
→ 要改善

[Phase 4] Improve #1
└─ フック強化、具体性追加

[Phase 3] Review #2 → 88/100
→ 改善推奨

[Phase 4] Improve #2
└─ CTA最適化

[Phase 3] Review #3 → 94/100
→ ✅ 採用

[Phase 5] Finalize
├─ 保存: scripts/final/20251209_AIエージェント自動化.md
├─ イテレーション: 3回
└─ 最終スコア: 94/100

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Pipeline Completed (3h 45min)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## オプション

| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `--skip-research` | リサーチをスキップ | false |
| `--skip-trend` | トレンドリサーチをスキップ | false |
| `--target-score N` | 目標スコア | 90 |
| `--max-iterations N` | 最大改善回数 | 3 |

---

## 失敗時の対応

### スコアが上がらない場合

3回改善してもスコア70未満の場合:
1. テーマの再検討を提案
2. 参考タイトルの見直し
3. `video-concept-agent` で根本から再生成

### エラー発生時

各フェーズでエラーが発生した場合:
1. エラー内容を表示
2. 該当フェーズから再開可能

---

## 関連コマンド

- `/research [テーマ]` - リサーチのみ実行
- `/video-concept [テーマ]` - 台本生成のみ実行
- `/trend-research [テーマ]` - 外部トレンドリサーチのみ実行
- `/script-review [台本]` - レビューのみ実行
- `/script-improve [台本] [レビュー]` - 改善のみ実行
